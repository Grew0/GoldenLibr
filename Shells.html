<!DOCTYPE html>
<html>
<head>
    <title>Библиотека Золотой академии</title>

    <link rel='stylesheet' href='Shells.css'>
</head>
<body style="margin: 0;">
    <div id="iframeback" onclick="iframe_controller.closeifr()"></div>
    <div id="outifr">
        <iframe id="ifr">
        </iframe>
    </div>

    <img src="paper.jpg"
        style="
            width: 110vw;
            height: 110vh;
            position: fixed; 
            z-index: -10000;
            margin-top: 0; 
        "
    >
    <main>
        <h1>Добро пожаловать в филиал<div></div>библиотеки Золотой академии</h1>    
        <div class="galer">            
            <div class="book_cont" id="book1"><div class="book">
                <a href="door.html">
                    <img src="cover.svg" class="cover">
                    <img src="sheet.svg" class="sheet">
                    <p>Назад к двери</p>
                </a>
            </div></div>
            <div class="book_cont" id="book2"><div class="book">
                <a>
                    <img src="cover.svg" class="cover">
                    <img src="sheet.svg" class="sheet">
                    <p>ПОУМ</p>
                </a>
            </div></div>
            <div class="book_cont" id="book3"><div class="book">
                <a>
                    <img src="cover.svg" class="cover">
                    <img src="sheet.svg" class="sheet">
                    <p>Поум</p>
                </a>
            </div></div>
            <div class="book_cont" id="book4"><div class="book">
                <a>
                    <img src="cover.svg" class="cover">
                    <img src="sheet.svg" class="sheet">
                    <p>Поум</p>
                </a>
            </div></div>
            <div class="book_cont" id="book5"><div class="book">
                <a>
                    <img src="cover.svg" class="cover">
                    <img src="sheet.svg" class="sheet">
                    <p>Поум</p>
                </a>
            </div></div>
            <div class="book_cont" id="book6"><div class="book">
                <a>
                    <img src="cover.svg" class="cover">
                    <img src="sheet.svg" class="sheet">
                    <p>Поум</p>
                </a>
            </div></div>
            <div class="book_cont" id="book7"><div class="book">
                <a>
                    <img src="cover.svg" class="cover">
                    <img src="sheet.svg" class="sheet">
                    <p>Поум</p>
                </a>
            </div></div>


        </div>
    </main>
</body>
<footer>
    <h3>Связь с нами</h1>
    <address>
        <a href = "tel:555-Смерть">Наш телефон (555-Смерть)</a>
        <a href = "mailto:chikunov.d.s@edu.mirea.ru">Наш электронный адрес (chikunov.d.s@edu.mirea.ru)</a>
        <span>&copy;Чикунов Д.С.</span>
    </address>
</footer>

</html>

<script>    

    let items = {
        "book2": "res/ПОУМ/ПОУМ.html"
    };

    let iframe_controller = null;
    let iframe_controller_backup = {
            ifr: document.getElementById("ifr"), 
            outifr: document.getElementById("outifr"),
            ifrback: document.getElementById("iframeback"),

            open: function(res){
                console.log("open");
                iframe_controller.ifr.src = res
                iframe_controller.outifr.style.display = "block";
                iframe_controller.ifrback.style.display = "block";
                iframe_controller.outifr.style.animationName = "appear2";
                iframe_controller.ifrback.style.animationName = "appear2";
                iframe_controller.outifr.style.marginLeft = "calc(" + window.innerWidth/2 +  "px - 30vw)";                
            },

            closeifr: function(){
                console.log("close");
                iframe_controller.outifr.style.animationName = "disappear2";
                iframe_controller.ifrback.style.animationName = "disappear2";
                setTimeout(
                    ()=>{
                        iframe_controller.outifr.style.display = "none";
                        iframe_controller.ifrback.style.display = "none";
                    }, 250
                );
            }

        };
    function checksize(){
        let w = window.innerWidth;
        let h = window.innerHeight;

        if(w >= h){
            window.onmessage = function(event){
                if(event.data == "close_window"){
                    iframe_controller.closeifr();
                }
                if(event.data == "is phone" && iframe_controller != null){
                    console.log(iframe_controller)
                    ifr.contentWindow.postMessage("from iframe", "*");
                }
            }

            document.cookie = "user=Fun";
            
            if(iframe_controller == null)
                iframe_controller = iframe_controller_backup;
                // else{
                //     //document.cookie = "user = " + iframe_controller.toString();
                //     console.log(document.cookie);
                // }

            
            for(let key in items){
                let item = document.getElementById(key);
                item.querySelector("a").onclick = function(){
                    iframe_controller.open(items[key])
                };
                item.querySelector("a").removeAttribute("href");
            }
        }else{
            iframe_controller = null;

            for(let key in items){
                console.log(key, items[key]);
                let item = document.getElementById(key);
                item.querySelector("a").href = items[key];
            }
        }


        // let allbooks = document.getElementsByClassName("book");
        // for(let i=0;i<allbooks.length;i++){
        //     let p = allbooks[i].querySelector('a').querySelector('p');
        //     p.style.left = allbooks[i].querySelector('a').offsetLeft + "px";
        // }

    }
    checksize();
    window.addEventListener('resize', ()=>{
        checksize();
        iframe_controller_backup.outifr.style.marginLeft = "calc(" + window.innerWidth/2 +  "px - 30vw)";
    });
    
</script>
